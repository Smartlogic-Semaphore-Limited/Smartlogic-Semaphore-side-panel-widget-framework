/****
 * WorkbenchWidgetApi
 * https://github.com/Smartlogic-Semaphore-Limited/workbench-widget-api
 *
 * @author Smartlogic Semaphore
 * @link 
 * @version 1.2.0
 *
 * Released under  License. See LICENSE.txt*/


"function"!=typeof JSON.decycle&&(JSON.decycle=function(e){"use strict";var s=[],o=[];return function e(t,r){var a,i,n;if("object"!=typeof t||null===t||t instanceof Boolean||t instanceof Date||t instanceof Number||t instanceof RegExp||t instanceof String)return t;for(a=0;a<s.length;a+=1)if(s[a]===t)return{$ref:o[a]};if(s.push(t),o.push(r),"[object Array]"===Object.prototype.toString.apply(t))for(n=[],a=0;a<t.length;a+=1)n[a]=e(t[a],r+"["+a+"]");else for(i in n={},t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=e(t[i],r+"["+JSON.stringify(i)+"]"));return n}(e,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(item));else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)))}($),$}),function(e,t){if("function"==typeof define&&define.amd)define("Semaphore",["exports"],t);else if("undefined"!=typeof exports)t(exports);else{var r={};t(r),e.Semaphore=r}}("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:this,function(e){"use strict";function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,a)}return r}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],a=!0,i=!1,n=void 0;try{for(var s,o=e[Symbol.iterator]();!(a=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){i=!0,n=e}finally{try{a||null==o.return||o.return()}finally{if(i)throw n}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return i(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}function s(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Object.defineProperty(e,"__esModule",{value:!0}),e.WorkbenchWidgetApi=void 0;var c=decodeURIComponent(window.location.hash.substr(1).replace(/^\//,"").replace(/\+/g," ")),t=function(){function r(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:c,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),this.widgetId=e,this.debug=t,o(this,"_promises",new Map),o(this,"getAssociativeTypes",this._dataSourcesWithTaskAndItemUri("getAssociativeTypes")),o(this,"getBroaderTypes",this._dataSourcesWithTaskAndItemUri("getBroaderTypes")),o(this,"getNarrowerTypes",this._dataSourcesWithTaskAndItemUri("getNarrowerTypes")),o(this,"getAltLabelUnfilteredProperties",this._dataSourcesWithTaskAndItemUri("getAltLabelUnfilteredProperties")),o(this,"getAltLabelProperties",this._dataSourcesWithTaskAndItemUri("getAltLabelProperties")),o(this,"getMetadataUnfilteredTypes",this._dataSourcesWithTaskAndItemUri("getMetadataUnfilteredTypes")),o(this,"getMetadataTypes",this._dataSourcesWithTaskAndItemUri("getMetadataTypes")),o(this,"getDetailsWithMetadata",this._dataSourcesWithTaskAndItemUri("getDetailsWithMetadata")),o(this,"getMetadataForDomain",this._dataSourceWithItemAndDomainUri("getMetadataForDomain")),o(this,"getConceptDetails",this._dataSourcesWithTaskAndItemUri("getConceptDetails")),o(this,"getConceptGuid",this._dataSourcesWithTaskAndItemUri("getConceptGuid")),o(this,"getConceptPrefLabels",this._dataSourcesWithTaskAndItemUri("getConceptPrefLabels")),o(this,"getConceptAltLabels",this._dataSourcesWithTaskAndItemUri("getConceptAltLabels")),o(this,"getConceptRelated",this._dataSourcesWithTaskAndItemUriAndPaging("getConceptRelated")),o(this,"getConceptNarrower",this._dataSourcesWithTaskAndItemUriAndPaging("getConceptNarrower")),o(this,"getConceptBroader",this._dataSourcesWithTaskAndItemUriAndPaging("getConceptBroader")),o(this,"getTopConcepts",this._dataSourcesWithTaskAndItemUriAndPaging("getTopConcepts")),o(this,"actions",{call:this._actionCall,showFormAddPrefLabel:function(e,t){return i._actionCall("showFormAddPrefLabel",{name:e,langCode:t})},showFormAddAltLabel:function(e,t,r){return i._actionCall("showFormAddAltLabel",{name:e,langCode:t,typeUri:r})},showFormAddMultipleAltLabel:function(e,t,r){return i._actionCall("showFormAddMultipleAltLabel",{names:e,langCode:t,typeUri:r})},showFormAddRelated:function(e,t,r){return i._actionCall("showFormAddRelated",{typeUri:e,targetUri:t,targetName:r})},showFormAddBroader:function(e,t,r){return i._actionCall("showFormAddBroader",{typeUri:e,targetUri:t,targetName:r})},showFormAddNarrower:function(e,t,r){return i._actionCall("showFormAddNarrower",{typeUri:e,targetUri:t,targetName:r})}}),o(this,"withOnlyDefinedValues",function(e){return Object.fromEntries(Object.entries(e).filter(function(e){var t=n(e,2);t[0];return null!=t[1]}))}),o(this,"_postIndex",0),o(this,"_receiveMessage",function(e){var t;i._logMessage("receiveMessage",e);var r=null===(t=e.data)||void 0===t?void 0:t.tag;if(r&&i._promises.has(r)){var a=i._promises.get(r);"response"===e.data.type&&(void 0!==e.data.results?a.resolve(JSON.retrocycle(e.data.results)):void 0!==e.data.reason?a.reject(JSON.retrocycle(e.data.reason)):i._logError("Response message need results or reason in data.")),i._promises.delete(r)}}),window.addEventListener("message",this._receiveMessage,!1),this._postMessage(this._createMessage(this.widgetId,"ready"))}return function(e,t,r){t&&s(e.prototype,t),r&&s(e,r)}(r,[{key:"getStateParams",value:function(){var e=this._createMessage(this.widgetId,"getStateParams");return this._postMessage(e)}},{key:"navigateToItem",value:function(e){var t=this._createMessage(this.widgetId,"navigateToItem",{item:e});return this._postMessage(t)}},{key:"closeWidget",value:function(){var e=this._createMessage(this.widgetId,"closeWidget");return this._postMessage(e)}},{key:"openWidget",value:function(e){var t=this._createMessage(e,"openWidget");return this._postMessage(t)}},{key:"getClasses",value:function(e){return this._dataSourcesWithTaskUri("getClasses",e)}},{key:"getAssociativeUnfilteredTypes",value:function(e){return this._dataSourcesWithTaskUri("getAssociativeUnfilteredTypes",e)}},{key:"getBroaderUnfilteredTypes",value:function(e){return this._dataSourcesWithTaskUri("getBroaderUnfilteredTypes",e)}},{key:"getNarrowerUnfilteredTypes",value:function(e){return this._dataSourcesWithTaskUri("getNarrowerUnfilteredTypes",e)}},{key:"getSemaphoreSettings",value:function(e){return this._dataSourcesWithTaskUri("getSemaphoreSettings",e)}},{key:"getConceptSchemes",value:function(e){return this._dataSourcesWithTaskUri("getConceptSchemes",e)}},{key:"_actionCall",value:function(e,t){var r=this._createMessage(this.widgetId,"callAction",{action:e,data:t});return this._postMessage(r)}},{key:"_getBackendData",value:function(e,t){var r=this._createMessage(this.widgetId,"getBackendData",{backendFunction:e,backendArguments:t});return this._postMessage(r)}},{key:"_dataSourcesWithTaskAndItemUri",value:function(r){var a=this;return function(e,t){return a._getBackendData(r,{taskGraphUri:e,itemUri:t})}}},{key:"_dataSourcesWithTaskAndItemUriAndPaging",value:function(i){var n=this;return function(e,t,r,a){return n._getBackendData(i,{taskGraphUri:e,itemUri:t,limit:r,offset:a})}}},{key:"_dataSourceWithItemAndDomainUri",value:function(r){var a=this;return function(e,t){return a._getBackendData(r,{taskGraphUri:e,domainUri:t})}}},{key:"_dataSourcesWithTaskUri",value:function(e,t){return this._getBackendData(e,{taskGraphUri:t})}},{key:"_createMessage",value:function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return{type:"action",key:t,data:function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach(function(e){o(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({widgetId:e},this.withOnlyDefinedValues(r))}}},{key:"_postMessage",value:function(e){var t=this._generateTag();e.data.tag=t;var r={};return r.promise=new Promise(function(e,t){r.resolve=e,r.reject=t}),this._promises.set(t,r),window.parent.postMessage(JSON.decycle(e),"*"),this._logMessage("postMessage",e),r.promise}},{key:"_generateTag",value:function(){return this._postIndex++,this.widgetId+"_"+this._postIndex}},{key:"_logMessage",value:function(){var e;this.debug&&(e=console).log.apply(e,arguments)}},{key:"_logError",value:function(){var e;this.debug&&(e=console).error.apply(e,arguments)}}]),r}();e.WorkbenchWidgetApi=t});