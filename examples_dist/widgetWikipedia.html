
<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8">

  <title>Simple widget wikipedia</title>
  <!-- grunt embed task will embed content of workbench-widget-api.min.js into html -->
  <script>
  /****
   * WorkbenchWidgetApi
   * https://github.com/Smartlogic-Semaphore-Limited/workbench-widget-api
   *
   * @author Smartlogic Semaphore
   * @link 
   * @version 1.2.0
   *
   * Released under  License. See LICENSE.txt*/
  
  
  !function(t){"use strict";if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define(t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else{if("undefined"==typeof window&&"undefined"==typeof self)throw new Error("This environment was not anticipated by Q. Please file a bug.");var e="undefined"!=typeof window?window:self,n=e.Q;e.Q=t(),e.Q.noConflict=function(){return e.Q=n,this}}}(function(){"use strict";var u=!1;try{throw new Error}catch(t){u=!!t.stack}function e(){}var o,i=j(),p=function(){var n={task:void 0,next:null},e=n,r=!1,o=void 0,i=!1,a=[];function u(){for(var t,e;n.next;)t=(n=n.next).task,n.task=void 0,(e=n.domain)&&(n.domain=void 0,e.enter()),c(t,e);for(;a.length;)c(t=a.pop());r=!1}function c(t,e){try{t()}catch(t){if(i)throw e&&e.exit(),setTimeout(u,0),e&&e.enter(),t;setTimeout(function(){throw t},0)}e&&e.exit()}if(p=function(t){e=e.next={task:t,domain:i&&process.domain,next:null},r||(r=!0,o())},"object"==typeof process&&"[object process]"===process.toString()&&process.nextTick)i=!0,o=function(){process.nextTick(u)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,u):function(){setImmediate(u)};else if("undefined"!=typeof MessageChannel){var t=new MessageChannel;t.port1.onmessage=function(){o=s,(t.port1.onmessage=u)()};var s=function(){t.port2.postMessage(0)};o=function(){setTimeout(u,0),s()}}else o=function(){setTimeout(u,0)};return p.runAfter=function(t){a.push(t),r||(r=!0,o())},p}(),n=Function.call;function t(t){return function(){return n.apply(t,arguments)}}var a,c=t(Array.prototype.slice),s=t(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;n<r;n++)n in this&&(e=t(e,this[n],n));return e}),r=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),f=t(Array.prototype.map||function(r,o){var i=this,a=[];return s(i,function(t,e,n){a.push(r.call(o,e,n,i))},void 0),a}),l=Object.create||function(t){function e(){}return e.prototype=t,new e},d=Object.defineProperty||function(t,e,n){return t[e]=n.value,t},y=t(Object.prototype.hasOwnProperty),h=Object.keys||function(t){var e=[];for(var n in t)y(t,n)&&e.push(n);return e},v=t(Object.prototype.toString);a="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var m="From previous event:";function g(t,e){if(u&&e.stack&&"object"==typeof t&&null!==t&&t.stack){for(var n=[],r=e;r;r=r.source)r.stack&&(!t.__minimumStackCounter__||t.__minimumStackCounter__>r.stackCounter)&&(d(t,"__minimumStackCounter__",{value:r.stackCounter,configurable:!0}),n.unshift(r.stack));n.unshift(t.stack);var o=function(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var o=e[r];!b(o)&&(-1===(i=o).indexOf("(module.js:")&&-1===i.indexOf("(node.js:"))&&o&&n.push(o)}var i;return n.join("\n")}(n.join("\n"+m+"\n"));d(t,"stack",{value:o,configurable:!0})}}function w(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function b(t){var e=w(t);if(!e)return!1;var n=e[0],r=e[1];return n===o&&i<=r&&r<=V}function j(){if(u)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=w(0<e[0].indexOf("@")?e[1]:e[2]);if(!n)return;return o=n[0],n[1]}}function k(t){return t instanceof O?t:U(t)?function(t){var e=S();return k.nextTick(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}}),e.promise}(t):B(t)}(k.resolve=k).nextTick=p,k.longStackSupport=!1;var T=1;function S(){var o,i=[],a=[],t=l(S.prototype),e=l(O.prototype);if(e.promiseDispatch=function(t,e,n){var r=c(arguments);i?(i.push(r),"when"===e&&n[1]&&a.push(n[1])):k.nextTick(function(){o.promiseDispatch.apply(o,r)})},e.valueOf=function(){if(i)return e;var t=N(o);return R(t)&&(o=t),t},e.inspect=function(){return o?o.inspect():{state:"pending"}},k.longStackSupport&&u)try{throw new Error}catch(t){e.stack=t.stack.substring(t.stack.indexOf("\n")+1),e.stackCounter=T++}function n(n){o=n,k.longStackSupport&&u&&(e.source=n),s(i,function(t,e){k.nextTick(function(){n.promiseDispatch.apply(n,e)})},void 0),a=i=void 0}return t.promise=e,t.resolve=function(t){o||n(k(t))},t.fulfill=function(t){o||n(B(t))},t.reject=function(t){o||n(_(t))},t.notify=function(n){o||s(a,function(t,e){k.nextTick(function(){e(n)})},void 0)},t}function A(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=S();try{t(e.resolve,e.reject,e.notify)}catch(t){e.reject(t)}return e.promise}function x(o){return A(function(t,e){for(var n=0,r=o.length;n<r;n++)k(o[n]).then(t,e)})}function O(o,i,e){void 0===i&&(i=function(t){return _(new Error("Promise does not support operation: "+t))}),void 0===e&&(e=function(){return{state:"unknown"}});var a=l(O.prototype);if(a.promiseDispatch=function(t,e,n){var r;try{r=o[e]?o[e].apply(a,n):i.call(a,e,n)}catch(t){r=_(t)}t&&t(r)},a.inspect=e){var t=e();"rejected"===t.state&&(a.exception=t.reason),a.valueOf=function(){var t=e();return"pending"===t.state||"rejected"===t.state?a:t.value}}return a}function C(t,e,n,r){return k(t).then(e,n,r)}function N(t){if(R(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function R(t){return t instanceof O}function U(t){return function(t){return t===Object(t)}(t)&&"function"==typeof t.then}"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(k.longStackSupport=!0),(k.defer=S).prototype.makeNodeResolver=function(){var n=this;return function(t,e){t?n.reject(t):2<arguments.length?n.resolve(c(arguments,1)):n.resolve(e)}},k.Promise=A,(k.promise=A).race=x,A.all=J,A.reject=_,(A.resolve=k).passByCopy=function(t){return t},O.prototype.passByCopy=function(){return this},k.join=function(t,e){return k(t).join(e)},O.prototype.join=function(t){return k([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Q can't join: not the same: "+t+" "+e)})},k.race=x,O.prototype.race=function(){return this.then(k.race)},(k.makePromise=O).prototype.toString=function(){return"[object Promise]"},O.prototype.then=function(e,n,r){var o=this,i=S(),a=!1;return k.nextTick(function(){o.promiseDispatch(function(t){a||(a=!0,i.resolve(function(t){try{return"function"==typeof e?e(t):t}catch(t){return _(t)}}(t)))},"when",[function(t){a||(a=!0,i.resolve(function(t){if("function"==typeof n){g(t,o);try{return n(t)}catch(t){return _(t)}}return _(t)}(t)))}])}),o.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=function(t){return"function"==typeof r?r(t):t}(t)}catch(t){if(n=!0,!k.onerror)throw t;k.onerror(t)}n||i.notify(e)}]),i.promise},k.tap=function(t,e){return k(t).tap(e)},O.prototype.tap=function(e){return e=k(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},k.when=C,O.prototype.thenResolve=function(t){return this.then(function(){return t})},k.thenResolve=function(t,e){return k(t).thenResolve(e)},O.prototype.thenReject=function(t){return this.then(function(){throw t})},k.thenReject=function(t,e){return k(t).thenReject(e)},k.nearer=N,k.isPromise=R,k.isPromiseAlike=U,k.isPending=function(t){return R(t)&&"pending"===t.inspect().state},O.prototype.isPending=function(){return"pending"===this.inspect().state},k.isFulfilled=function(t){return!R(t)||"fulfilled"===t.inspect().state},O.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},k.isRejected=function(t){return R(t)&&"rejected"===t.inspect().state},O.prototype.isRejected=function(){return"rejected"===this.inspect().state};var P,E,F,D=[],M=[],L=[],I=!0;function Q(){D.length=0,M.length=0,I||(I=!0)}function _(e){var t=O({when:function(t){return t&&function(e){if(I){var n=r(M,e);-1!==n&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){var t=r(L,e);-1!==t&&(process.emit("rejectionHandled",D[n],e),L.splice(t,1))}),M.splice(n,1),D.splice(n,1))}}(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return function(t,e){I&&("object"==typeof process&&"function"==typeof process.emit&&k.nextTick.runAfter(function(){-1!==r(M,t)&&(process.emit("unhandledRejection",e,t),L.push(t))}),M.push(t),e&&void 0!==e.stack?D.push(e.stack):D.push("(no stack) "+e))}(t,e),t}function B(n){return O({when:function(){return n},get:function(t){return n[t]},set:function(t,e){n[t]=e},delete:function(t){delete n[t]},post:function(t,e){return null==t?n.apply(void 0,e):n[t].apply(n,e)},apply:function(t,e){return n.apply(t,e)},keys:function(){return h(n)}},void 0,function(){return{state:"fulfilled",value:n}})}function $(t,e,n){return k(t).spread(e,n)}function W(t,e,n){return k(t).dispatch(e,n)}function J(t){return C(t,function(o){var i=0,a=S();return s(o,function(t,e,n){var r;R(e)&&"fulfilled"===(r=e.inspect()).state?o[n]=r.value:(++i,C(e,function(t){o[n]=t,0==--i&&a.resolve(o)},a.reject,function(t){a.notify({index:n,value:t})}))},void 0),0===i&&a.resolve(o),a.promise})}function G(o){if(0===o.length)return k.resolve();var i=k.defer(),a=0;return s(o,function(t,e,n){var r=o[n];a++,C(r,function(t){i.resolve(t)},function(t){if(0==--a){var e=t||new Error(""+t);e.message="Q can't get fulfillment value from any promise, all promises were rejected. Last error message: "+e.message,i.reject(e)}},function(t){i.notify({index:n,value:t})})},void 0),i.promise}function z(t){return C(t,function(t){return t=f(t,k),C(J(f(t,function(t){return C(t,e,e)})),function(){return t})})}k.resetUnhandledRejections=Q,k.getUnhandledReasons=function(){return D.slice()},k.stopUnhandledRejectionTracking=function(){Q(),I=!1},Q(),k.reject=_,k.fulfill=B,k.master=function(n){return O({isDef:function(){}},function(t,e){return W(n,t,e)},function(){return k(n).inspect()})},k.spread=$,O.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},k.async=function(e){return function(){function t(t,e){var n;if("undefined"==typeof StopIteration){try{n=r[t](e)}catch(t){return _(t)}return n.done?k(n.value):C(n.value,o,i)}try{n=r[t](e)}catch(t){return function(t){return"[object StopIteration]"===v(t)||t instanceof a}(t)?k(t.value):_(t)}return C(n,o,i)}var r=e.apply(this,arguments),o=t.bind(t,"next"),i=t.bind(t,"throw");return o()}},k.spawn=function(t){k.done(k.async(t)())},k.return=function(t){throw new a(t)},k.promised=function(n){return function(){return $([this,J(arguments)],function(t,e){return n.apply(t,e)})}},k.dispatch=W,O.prototype.dispatch=function(t,e){var n=this,r=S();return k.nextTick(function(){n.promiseDispatch(r.resolve,t,e)}),r.promise},k.get=function(t,e){return k(t).dispatch("get",[e])},O.prototype.get=function(t){return this.dispatch("get",[t])},k.set=function(t,e,n){return k(t).dispatch("set",[e,n])},O.prototype.set=function(t,e){return this.dispatch("set",[t,e])},k.del=k.delete=function(t,e){return k(t).dispatch("delete",[e])},O.prototype.del=O.prototype.delete=function(t){return this.dispatch("delete",[t])},k.mapply=k.post=function(t,e,n){return k(t).dispatch("post",[e,n])},O.prototype.mapply=O.prototype.post=function(t,e){return this.dispatch("post",[t,e])},k.send=k.mcall=k.invoke=function(t,e){return k(t).dispatch("post",[e,c(arguments,2)])},O.prototype.send=O.prototype.mcall=O.prototype.invoke=function(t){return this.dispatch("post",[t,c(arguments,1)])},k.fapply=function(t,e){return k(t).dispatch("apply",[void 0,e])},O.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},k.try=k.fcall=function(t){return k(t).dispatch("apply",[void 0,c(arguments,1)])},O.prototype.fcall=function(){return this.dispatch("apply",[void 0,c(arguments)])},k.fbind=function(t){var e=k(t),n=c(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(c(arguments))])}},O.prototype.fbind=function(){var t=this,e=c(arguments);return function(){return t.dispatch("apply",[this,e.concat(c(arguments))])}},k.keys=function(t){return k(t).dispatch("keys",[])},O.prototype.keys=function(){return this.dispatch("keys",[])},k.all=J,O.prototype.all=function(){return J(this)},k.any=G,O.prototype.any=function(){return G(this)},k.allResolved=(P=z,E="allResolved",F="allSettled",function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(E+" is deprecated, use "+F+" instead.",new Error("").stack),P.apply(P,arguments)}),O.prototype.allResolved=function(){return z(this)},k.allSettled=function(t){return k(t).allSettled()},O.prototype.allSettled=function(){return this.then(function(t){return J(f(t,function(t){function e(){return t.inspect()}return(t=k(t)).then(e,e)}))})},k.fail=k.catch=function(t,e){return k(t).then(void 0,e)},O.prototype.fail=O.prototype.catch=function(t){return this.then(void 0,t)},k.progress=function(t,e){return k(t).then(void 0,void 0,e)},O.prototype.progress=function(t){return this.then(void 0,void 0,t)},k.fin=k.finally=function(t,e){return k(t).finally(e)},O.prototype.fin=O.prototype.finally=function(e){if(!e||"function"!=typeof e.apply)throw new Error("Q can't apply finally callback");return e=k(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},k.done=function(t,e,n,r){return k(t).done(e,n,r)},O.prototype.done=function(t,e,n){var r=function(t){k.nextTick(function(){if(g(t,o),!k.onerror)throw t;k.onerror(t)})},o=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(r=process.domain.bind(r)),o.then(void 0,r)},k.timeout=function(t,e,n){return k(t).timeout(e,n)},O.prototype.timeout=function(t,e){var n=S(),r=setTimeout(function(){e&&"string"!=typeof e||((e=new Error(e||"Timed out after "+t+" ms")).code="ETIMEDOUT"),n.reject(e)},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)},n.notify),n.promise},k.delay=function(t,e){return void 0===e&&(e=t,t=void 0),k(t).delay(e)},O.prototype.delay=function(n){return this.then(function(t){var e=S();return setTimeout(function(){e.resolve(t)},n),e.promise})},k.nfapply=function(t,e){return k(t).nfapply(e)},O.prototype.nfapply=function(t){var e=S(),n=c(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},k.nfcall=function(t){var e=c(arguments,1);return k(t).nfapply(e)},O.prototype.nfcall=function(){var t=c(arguments),e=S();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},k.nfbind=k.denodeify=function(n){if(void 0===n)throw new Error("Q can't wrap an undefined function");var r=c(arguments,1);return function(){var t=r.concat(c(arguments)),e=S();return t.push(e.makeNodeResolver()),k(n).fapply(t).fail(e.reject),e.promise}},O.prototype.nfbind=O.prototype.denodeify=function(){var t=c(arguments);return t.unshift(this),k.denodeify.apply(void 0,t)},k.nbind=function(n,r){var o=c(arguments,2);return function(){var t=o.concat(c(arguments)),e=S();return t.push(e.makeNodeResolver()),k(function(){return n.apply(r,arguments)}).fapply(t).fail(e.reject),e.promise}},O.prototype.nbind=function(){var t=c(arguments,0);return t.unshift(this),k.nbind.apply(void 0,t)},k.nmapply=k.npost=function(t,e,n){return k(t).npost(e,n)},O.prototype.nmapply=O.prototype.npost=function(t,e){var n=c(e||[]),r=S();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},k.nsend=k.nmcall=k.ninvoke=function(t,e){var n=c(arguments,2),r=S();return n.push(r.makeNodeResolver()),k(t).dispatch("post",[e,n]).fail(r.reject),r.promise},O.prototype.nsend=O.prototype.nmcall=O.prototype.ninvoke=function(t){var e=c(arguments,1),n=S();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},k.nodeify=function(t,e){return k(t).nodeify(e)},O.prototype.nodeify=function(e){if(!e)return this;this.then(function(t){k.nextTick(function(){e(null,t)})},function(t){k.nextTick(function(){e(t)})})},k.noConflict=function(){throw new Error("Q.noConflict only works when Q is used as a global")};var V=j();return k}),"function"!=typeof JSON.decycle&&(JSON.decycle=function(t){"use strict";var a=[],u=[];return function t(e,n){var r,o,i;if("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof String)return e;for(r=0;r<a.length;r+=1)if(a[r]===e)return{$ref:u[r]};if(a.push(e),u.push(n),"[object Array]"===Object.prototype.toString.apply(e))for(i=[],r=0;r<e.length;r+=1)i[r]=t(e[r],n+"["+r+"]");else for(o in i={},e)Object.prototype.hasOwnProperty.call(e,o)&&(i[o]=t(e[o],n+"["+JSON.stringify(o)+"]"));return i}(t,"$")}),"function"!=typeof JSON.retrocycle&&(JSON.retrocycle=function retrocycle($){"use strict";var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,"string"==typeof path&&px.test(path)?value[i]=eval(path):rez(item));else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,"string"==typeof path&&px.test(path)?value[name]=eval(path):rez(item)))}($),$}),function(){"use strict";var a,n,r=1,o={};function i(t,e){var n=l(a,"callAction"),r=h([{name:"action",type:"String"},{name:"data",type:"Object"}],arguments,"callAction");if(r.valid)return n.data.action=r.argumentsObj.action,n.data.data=r.argumentsObj.data,d(n)}function u(t,e,n){var r=l(t,"getBackendData");return r.data.backendArguments=n,r.data.backendFunction=e,d(r)}function c(r){return function(t,e){var n=h([{name:"taskGraphUri",type:"String"},{name:"itemUri",type:"String"}],arguments,r);if(n.valid)return u(a,r,n.argumentsObj)}}function s(i){return function(t,e,n,r){var o=h([{name:"taskGraphUri",type:"String"},{name:"itemUri",type:"String"},{name:"limit",type:"Number",optional:!0},{name:"offset",type:"Number",optional:!0}],arguments,i);if(o.valid)return u(a,i,o.argumentsObj)}}function p(n){return function(t){var e=h([{name:"taskGraphUri",type:"String"}],arguments,n);if(e.valid)return u(a,n,e.argumentsObj)}}function f(t){return null==t}function l(t,e){return{type:"action",key:e,data:{widgetId:t}}}function d(t){var e=function(t){return t+"_"+ ++r}(t.data.widgetId);return t.data.tag=e,o[e]=Q.defer(),window.top.postMessage(JSON.decycle(t),"*"),v("postMessage",t),o[e].promise}function y(t,e){return function(t){return Object.prototype.toString.call(t)}(t)==="[object "+e+"]"}function h(t,r,e){var o=[],i={};if(t.length&&t.forEach(function(t,e){var n=r[e];t.optional&&f(n)||y(n,t.type)?function(t,e,n,r){r&&f(n)||(t[e]=n)}(i,t.name,r[e],t.optional):o.push("Argument '"+t.name+"' needs to be of '"+t.type+"' type.")}),o.length)throw o.unshift("Api function '"+e+"' arguments list is invalid."),new Error(o.join("\n"));return{valid:!o.length,argumentsObj:i}}function v(){n&&console.log.apply(this,arguments)}window.addEventListener("message",function(t){v("receiveMessage",t),t.data.tag&&o[t.data.tag]&&("response"===t.data.type&&(void 0!==t.data.results?o[t.data.tag].resolve(JSON.retrocycle(t.data.results)):void 0!==t.data.reason?o[t.data.tag].reject(JSON.retrocycle(t.data.reason)):function(){n&&console.error.apply(this,arguments)}("Response message need results or reason in data.")),delete o[t.data.tag])},!1),window.WorkbenchWidgetApi=function(t,e){return a=t||decodeURIComponent(window.location.hash.substr(1).replace(/^\//,"").replace(/\+/g," ")),n=e,d(l(a,"ready")),{widgetId:a,getStateParams:function(){return d(l(a,"getStateParams"))},navigateToItem:function(t){var e=l(a,"navigateToItem"),n=h([{name:"item",type:"Object"}],arguments,"navigateToItem");if(n.valid)return e.data.item=n.argumentsObj.item,d(e)},closeWidget:function(){return d(l(a,"closeWidget"))},openWidget:function(t){var e=l(t,"openWidget");if(h([{name:"targetWidgetId",type:"String"}],arguments,"openWidget").valid)return d(e)},getClasses:p("getClasses"),getAssociativeUnfilteredTypes:p("getAssociativeUnfilteredTypes"),getAssociativeTypes:c("getAssociativeTypes"),getBroaderUnfilteredTypes:p("getBroaderUnfilteredTypes"),getBroaderTypes:c("getBroaderTypes"),getNarrowerUnfilteredTypes:p("getNarrowerUnfilteredTypes"),getNarrowerTypes:c("getNarrowerTypes"),getSemaphoreSettings:p("getSemaphoreSettings"),getAltLabelUnfilteredProperties:c("getAltLabelUnfilteredProperties"),getAltLabelProperties:c("getAltLabelProperties"),getMetadataUnfilteredTypes:c("getMetadataUnfilteredTypes"),getMetadataTypes:c("getMetadataTypes"),getDetailsWithMetadata:c("getDetailsWithMetadata"),getMetadataForDomain:function(r){return function(t,e){var n=h([{name:"taskGraphUri",type:"String"},{name:"domainUri",type:"String"}],arguments,r);if(n.valid)return u(a,r,n.argumentsObj)}}("getMetadataForDomain"),getConceptSchemes:p("getConceptSchemes"),getConceptDetails:c("getConceptDetails"),getConceptGuid:c("getConceptGuid"),getConceptPrefLabels:c("getConceptPrefLabels"),getConceptAltLabels:c("getConceptAltLabels"),getConceptRelated:s("getConceptRelated"),getConceptNarrower:s("getConceptNarrower"),getConceptBroader:s("getConceptBroader"),getTopConcepts:s("getTopConcepts"),actions:{call:i,showFormAddPrefLabel:function(t,e){return i("showFormAddPrefLabel",{name:t,langCode:e})},showFormAddAltLabel:function(t,e,n){return i("showFormAddAltLabel",{name:t,langCode:e,typeUri:n})},showFormAddMultipleAltLabel:function(t,e,n){return i("showFormAddMultipleAltLabel",{names:t,langCode:e,typeUri:n})},showFormAddRelated:function(t,e,n){return i("showFormAddRelated",{typeUri:t,targetUri:e,targetName:n})},showFormAddBroader:function(t,e,n){return i("showFormAddBroader",{typeUri:t,targetUri:e,targetName:n})},showFormAddNarrower:function(t,e,n){return i("showFormAddNarrower",{typeUri:t,targetUri:e,targetName:n})}}}}}();
  </script>
  <script src="//code.jquery.com/jquery-2.2.1.min.js"></script>
  <script
    src="//ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
        integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
        crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
        integrity="sha384-fLW2N01lMqjakBkx3l/M9EahuwpSfeNvV63J5ezn3uZzapT0u7EYsXMjQV+0En5r"
        crossorigin="anonymous">


  <link rel="stylesheet" crossorigin="anonymous"
        href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.1/animate.min.css">


  <link rel="stylesheet" crossorigin="anonymous"
        href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.6/flatly/bootstrap.min.css">

  <script
    src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"
    integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
    crossorigin="anonymous"></script>

  <script>
    var api = new WorkbenchWidgetApi();
    api.getStateParams().then(function (data) {

      api.getConceptDetails(data.taskGraphUri, data.itemUri).then(function (concept) {


        // Get the pref label of the concept in the current language
        var conceptName = concept["meta:displayName"]["@value"];

        // Call out to Wikipedia to find out related resources
        $.ajax({
          dataType: "json",
          crossDomain: true,
          dataType: "jsonp",
          url: "//en.m.wikipedia.org/w/api.php?action=opensearch&format=json&language=en&uselang=en&type=item&continue=0&search=" + conceptName,
          success: function (data) {
            var dLabels = data[1], dDescriptions = data[2], dUrls = data[3],
              items = [],
              pageUrl = null;
            // data  =  [search term, labels[], descriptions[], urls[]]
            // Note: if description is empty or it end in "may refer to:" it is a disambiguation page

            // If there is a single match or if there is a direct match for the name let's open that one. Same thing if there is a disambiguation page


            if (dUrls.length === 1) {
              pageUrl = dUrls[0];
            } else {
              var name = conceptName.toLowerCase();
              $.each(dLabels, function (key, val) {
                if (val.toLowerCase() === name) {
                  pageUrl = dUrls[key];
                }
              });

              if (!pageUrl) {
                var re = new RegExp(".*(may|could) refer to:$");
                $.each(dLabels, function (key, val) {
                  if (re.test(val)) {
                    pageUrl = dUrls[key];
                  }
                });
              }

              if (!pageUrl) {
                $.each(dLabels, function (key) {
                  var id = dUrls[key].replace(/.*?\/wiki\//, ''),
                    line = "<li id=" + id + "><span class='wd-label'>" + dLabels[key] + "</span>";
                  line += " <span class='wd-description'>" + dDescriptions[key] + "</span>";
                  line += "</li>";
                  items.push(line);
                });
              }
            }

            if (pageUrl) {
              loadPage(pageUrl.replace(/.*?\/wiki\//, ''));
            } else if (items.length) {
              $("<h2>" + conceptName + " could refer to:</h2>").appendTo("#widget-content");
              $("<ul/>", {
                "class": "wd-results",
                "id": "wd-results",
                html: items.join("")
              }).appendTo("#widget-content");
            } else {
              $("<span class='wd-no-results'>No results found on Wikipedia</span>").appendTo("#widget-content");
            }
            $('#widget-content').show();
            $('#widget-error').hide();
            $('#widget-progress').hide();
            updateHistoryButtons();
          }
        });
        setupLinks();
      });

    });


    function setupLinks() {
      $('#widget-content')
        .off('click', '#wd-results li')
        .on('click', '#wd-results li', function () {
          loadPage($(this).attr('id'));
        });

      $('#widget-content')
        .off('click', 'a')
        .on('click', 'a', function (e) {
          var absoluteDetector = new RegExp('^(?:[a-z]+:)?//', 'i');
          var $this = $(this), href = $this.attr('href');
          if(absoluteDetector.test(href)) {
            $this.attr("target", "_blank");
          } else if (href.lastIndexOf('#', 0) !== 0) {
            e.preventDefault();
            var wikiPage = href.replace('/wiki/', '');
            loadPage(wikiPage);
          }
        });
      $('#widget-content a').each(function(index, element) {
        var absoluteDetector = new RegExp('^(?:[a-z]+:)?//', 'i'),
          href = $(element).attr('href');
        if(absoluteDetector.test(href)) {
          $(element).addClass("external");
        }
      });
    };

    function closeWidget() {
      api.closeWidget();
    }
    var myHistory = [], myHistoryIndex = 0;

    function historyBack() {
      if (myHistory.length > 0 && myHistoryIndex > 0) {
        myHistoryIndex--;
        loadPage(myHistory[myHistoryIndex], true);
      }

    }
    function historyForward() {
      if (myHistoryIndex < myHistory.length - 1) {
        myHistoryIndex++;
        loadPage(myHistory[myHistoryIndex], true);
      }
    }

    function updateHistoryButtons() {
      if (myHistory.length > 0 && myHistoryIndex > 0) {
        $("#widget-history-back").removeClass("disabled");
      } else {
        $("#widget-history-back").addClass("disabled");
      }
      if (myHistoryIndex < myHistory.length - 1) {
        $("#widget-history-forward").removeClass("disabled");
      } else {
        $("#widget-history-forward").addClass("disabled");
      }
    }
    function loadPage(page, fromHistory) {
      if(!fromHistory) {
        myHistory = myHistory.slice(0, myHistoryIndex + 1);
        myHistory.push(page);
        myHistoryIndex = myHistory.length - 1;
      }
      updateHistoryButtons();
      $('#widget-content').hide();
      $('#widget-error').hide();
      $('#widget-progress').show();
      $.ajax({
        dataType: "json",
        crossDomain: true,
        dataType: "json",
        url: "//en.wikipedia.org/api/rest_v1/page/mobile-sections/" + page,
        success: function success(data) {console.log("loadPage success",page, data)
          $('#widget-content').show();
          $('#widget-progress').hide();
          $('#widget-content').html("");
          if (data.lead) {
            $('<h2>' + data.lead.displaytitle + '</h2>').appendTo('#widget-content');
            $.each(data.lead.sections, function (key, val) {
              if (val.text) {
                $('<div>' + val.text + '</div>').appendTo('#widget-content');
              }
            });
          }

          if (data['remaining']) {

            var panelGroup = $('<div class="panel-group"></div>');
            panelGroup.appendTo('#widget-content');

            function toggleChev(e) {
              $(e.target).prev('.panel-heading').find('span.glyphicon').toggleClass('glyphicon-chevron-down glyphicon-chevron-up');
            };
            $('.panel-group').on('hide.bs.collapse show.bs.collapse', toggleChev);


            function nestArray(inputArray, levelCheck) {
              var tr; //threshold
              return inputArray.map(function (x, i, arr) {
                x.children = arr.map(function (y, j, inArr) {
                  if ((y[levelCheck] === (x[levelCheck] )) &&
                    (j > 1) &&
                    (!tr || tr < y.id)
                  ) {
                    //if we have siblings, we set the limit for each section to the
                    //id of the next sibling
                    tr = j;
                  } else if ((y[levelCheck] === (x[levelCheck] + 1)) && //a child has a level directly bigger
                    (j > i) && //no child is defined before a parent
                    (!tr || (tr && j <= tr)) //if a threshold is defined, don't add if tr is reached
                  ) {
                    y.parent = x.id;
                    return y;
                  }
                }).filter( Boolean );
                return x;
              }).filter( Boolean ).filter(function(x) {
                return x[levelCheck] == 1;
              });
            }


            function simpleMarkup (structuredData, container) {

              for(var i =0; i < structuredData.length; i++) {
                var elem = structuredData[i];
                // Format anchors
                var valAnchor = elem.anchor.replace(/\./g, '');
                var groupSection =  $('<div id="wikiSection'+ elem.id +'" class="toclevel'+ elem.toclevel +' panel panel-default"></div>');
                var heading = $('<div class="panel-heading" data="' + valAnchor + '" role="button" data-toggle="collapse" data-target="#' + valAnchor + '"><span class="font-bold"><span class="glyphicon glyphicon-chevron-down"></span>  ' + elem.line + '</span></div>');
                var panelContent =  $('<div id="' + valAnchor + '" class="panel-collapse collapse"></div>');
                var panelbody = $('<div class="panel-body">'+ elem.text +'</div>')
                var childrenContainer = $('<div class="sectionContent"></div>');
                var childHeading = $('<h4 class="child-heading">' + elem.line + '</<h4>');
                var childPanelbody = $('<span>'+ elem.text +'</span>')

                container.append(groupSection);//panel-group > panel-section

                if(elem.toclevel !== 1){
                  groupSection.append(childHeading);
                  groupSection.append(childPanelbody);
                  childPanelbody.append(childrenContainer);
                  groupSection.removeClass('panel panel-default')
                } else {
                  groupSection.append(heading);
                  groupSection.append(panelContent);
                  panelContent.append(panelbody);
                  panelbody.append(childrenContainer);
                }

                simpleMarkup(elem.children, childrenContainer);
              }

            }


            var structuredWikiDataArray = nestArray(data['remaining']['sections'], 'toclevel');

            simpleMarkup(structuredWikiDataArray, panelGroup);

          }

          // Add BS table formatting
          $('table').addClass('table table-striped table-condensed');
          setupLinks();
        }, error:function(){
          $('#widget-error').show();
          $('#widget-progress').hide();
        }
      });
    }

  </script>

  <style>

    /*Some Reset and Wiki overrides*/
    .btn-close {margin-top:10px;}

    .container{word-wrap: break-word; font-size: 13px;}

    img {margin:10px 0; max-width: 100%;}

    a{
      color: #0094cc;
      text-decoration: underline;
    }

    a:hover, a:focus, a:active{
      color:#31708f;
      text-decoration: underline;
    }

    button{
      outline:none !important;
      color:inherit !important;
    }

    .disabled{
      cursor:default !important;
      color:inherit !important;
    }

    .panel-default>.panel-heading {
      background-color: #f5f5f5 !important;
      background-image: none;
    }

    .panel-group{
      margin-top:10px;
    }

    blockquote{
      font-size: 16px;
    }

    .quotebox {
      margin: 10px 0 !important;
      padding:5px 5px 5px 20px !important;
      border:none !important;
      border-left: 5px solid #ccc !important;
      float: none !important;
    }

    .wrapper{
      padding:20px;
    }

    table{
      font-size: 11px;
      background:#fff;
      width:100% !important;
    }

    /*reset*/
    .child-heading{
      margin:25px 0 5px 0;
    }

    .toclevel2:first-child .child-heading{
      margin-top:0;
    }

    .thumbinner{
      width:100% !important;
    }

    .gallery{
      list-style: none;
    }

    .gallery .thumb div{
      margin-bottom: 0 !important;
    }

    figure img{
      width:100%;
      height:100%;
    }

    ul, ol{
      padding:0 15px;
    }

    a.external{
      color:#FF5722;
    }

    #wd-results {
      list-style: none;
      padding:0;
    }

    #wd-results li span.wd-label {
      color: #0094cc;
      text-decoration: none;
      cursor: pointer;
      display: block;
      font-weight: bold;
      font-size: 16px !important;
    }
    #wd-results li span.wd-label:hover {
      text-decoration: underline;
    }

    #wd-results li span.wd-label:hover {
      text-decoration: underline;
    }

    #wd-results .wd-description{
      margin-bottom: 10px !important;
      display:block;
      padding-bottom: 10px;
      border-bottom: 1px solid #efefef;
      cursor: pointer;
    }

  </style>

</head>

<body>

<div class="container animated fadeIn">
  <button class="btn btn-sm btn-close pull-right" onclick="closeWidget()">
    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
  </button>
  <button class="btn btn-sm btn-close" onclick="historyBack()" id="widget-history-back">
    <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> Back
  </button>
  <button class="btn btn-sm btn-close" onclick="historyForward()" id="widget-history-forward">
    <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span> Forward
  </button>
</div>

<div class="container animated fadeIn" id="widget-error" style="display:none;">
  <div class="wrapper text-center">
    <h1><span class="text-warning glyphicon glyphicon-alert" aria-hidden="true"></span></h1>
    <h4>Sorry we can not find what you was looking for...</h4>
    <p><button class="btn btn-sm btn-close" onclick="historyBack()">
      <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span> Back
    </button></p>
  </div>
</div>

<div class="container animated fadeIn" id="widget-content" style="display:none;">
</div>

<div class="container animated fadeIn" id="widget-progress">
  <div class="wrapper text-center">
    <h4><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Loading...</h4>
  </div>
</div>
</body>

</html>

